<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chat Threads</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 20px; }
      .nav { margin-bottom: 10px; }
      .message { margin: 8px 0; }
      .you { color: #222; }
      .bot { color: #005; }
      .alert { background:#ffd; padding:8px; border:1px solid #eee; }
      .thread-list { margin-bottom: 12px; }
    </style>
</head>
<body>
    <h2>Welcome to SHER's CHAT</h2>

    <div class="nav">
        <a href="{% url 'chat' %}">Threads</a> |
        <a href="{% url 'documents' %}">My Documents</a> |
        <a href="{% url 'logout' %}">Logout</a>
    </div>

    <!-- Django messages -->
    {% if messages %}
      <div class="alert">
      {% for msg in messages %}
        <div class="{{ msg.tags }}">{{ msg }}</div>
      {% endfor %}
      </div>
    {% endif %}

    <!-- thread links -->
    <div class="thread-list">
      <strong>Your threads:</strong>
      <ul>
        {% for t in threads %}
          <li><a href="?thread={{ t.id }}">{{ t.title }}</a></li>
        {% empty %}
          <li>No threads yet. Create one below.</li>
        {% endfor %}
      </ul>
    </div>

    {% if selected_thread %}
      <h3>Thread: {{ selected_thread.title }}</h3>

      <!-- message form - include CSRF token and preserve thread id in action -->
      <form method="post" action="?thread={{ selected_thread.id }}">
        {% csrf_token %}
        <input type="text" name="message" placeholder="Type your message..." required style="width:60%">
        <button type="submit">Send</button>
        <button type="submit" name="delete_thread" value="1" style="margin-left:8px;">Delete Thread</button>
      </form>

      <hr>

      <h3>Messages</h3>
      <div>
        {% for m in thread_messages %}
          <div class="message {% if m.sender == 'user' %}you{% else %}bot{% endif %}">
            <b>{% if m.sender == 'user' %}You:{% else %}Bot:{% endif %}</b>
            {{ m.content }}
          </div>
        {% empty %}
          <div>No messages in this thread yet.</div>
        {% endfor %}
      </div>

    {% else %}
      <p>No thread selected. Create a thread:</p>
      <form method="post">
        {% csrf_token %}
        <button type="submit" name="new_thread" value="1">Create new thread</button>
      </form>
    {% endif %}
</body>
</html>